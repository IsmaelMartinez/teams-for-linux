Refactor CSP setup to static method and centralize header handling - by @IsmaelMartinez (#2171)
