<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Teams for Linux - Call Pop-out</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            text-align: center;
            background-color: #f8f9fa;
            color: #212529;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        h1 {
            color: #0d6efd;
        }
    </style>
</head>
<body>
    <div id="screen-sharing-status">Loading screen sharing status...</div>
    <video id="screen-share-video" autoplay style="width: 100%; height: auto;"></video>

    <script>
        window.addEventListener('DOMContentLoaded', async () => {
            const statusDiv = document.getElementById('screen-sharing-status');
            const videoElement = document.getElementById('screen-share-video');

            const updateStatusAndStream = async () => {
                const isActive = await window.electronAPI.getScreenSharingStatus();
                statusDiv.innerText = isActive ? 'Screen is being shared.' : 'Nothing is being shared.';

                if (isActive) {
                    try {
                        const sourceId = await window.electronAPI.getScreenShareStream();
                        console.debug('Screen sharing status:', isActive, 'Source ID:', sourceId); // Added log
                        if (sourceId) {
                            const stream = await navigator.mediaDevices.getUserMedia({
                                audio: false,
                                video: {
                                    mandatory: {
                                        chromeMediaSource: 'desktop',
                                        chromeMediaSourceId: sourceId,
                                        minWidth: 1280,
                                        maxWidth: 1280,
                                        minHeight: 720,
                                        maxHeight: 720
                                    }
                                }
                            });
                            videoElement.srcObject = stream;
                            videoElement.style.display = 'block';
                        } else {
                            videoElement.srcObject = null;
                            videoElement.style.display = 'none';
                        }
                    } catch (error) {
                        console.error('Error getting screen share stream:', error);
                        videoElement.srcObject = null;
                        videoElement.style.display = 'none';
                    }
                } else {
                    videoElement.srcObject = null;
                    videoElement.style.display = 'none';
                }
            };
            // Initial status and stream update
            updateStatusAndStream();
            // Update status and stream every 2 seconds (adjust as needed)
            setInterval(updateStatusAndStream, 2000);
        });
    </script>
</body>
</html>