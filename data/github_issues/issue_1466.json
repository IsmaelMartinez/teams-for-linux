{
    "id": 2626468620,
    "number": 1466,
    "title": "Explicitly setting \"ssoInTuneAuthUser\" is broken",
    "body": "**Describe the bug**\r\nWhen explicitly specifying `ssoInTuneAuthUser` in the config, the inTune account will not be found even if it exists.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. set `ssoInTuneEnabled` to `true` and `ssoInTuneAuthUser` to an account that exists\r\n\r\n**Expected behavior**\r\nThe account is found.\r\n\r\n**Desktop:**\r\n - OS: Ubuntu 24.04 with working InTune\r\n - deb Installation\r\n - Version 1.11.2\r\n\r\n**Debug**\r\nWhen setting `ssoInTuneAuthUser`:\r\n\r\n```\r\n09:12:17.139 › Failed to find matching InTune account for myname@mycorp.de.\r\n```\r\n\r\nWhen only setting `ssoInTuneEnabled` to `true` and not specifying the user, so it uses the first one found:\r\n\r\n```\r\n09:58:14.080 › Using first available InTune account (myname@mycorp.de)\r\n```\r\n\r\n**Additional context**\r\n\r\nIt seems to be a bug in this part of `app/index.js`:\r\n\r\n```javascript\r\n\t\tfor (const account in response.accounts) {\r\n\t\t\tif (account.username == ssoInTuneAuthUser) {\r\n\t\t\t\tinTuneAccount = account;\r\n\t\t\t\tconsole.debug('Found matching InTune account (' + inTuneAccount.username + ')');\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n```\r\n\r\nI will just quote our friend GitHub Copilot here:\r\nThe behavior you are observing is due to the way the `processInTuneAccounts` function is implemented. Here is a brief explanation:\r\n\r\n**When `ssoInTuneAuthUser` is specified:**\r\n   - The function iterates over the `response.accounts` array to find an account with a username that matches `ssoInTuneAuthUser`.\r\n   - The loop uses `for (const account in response.accounts)`, which iterates over the keys (indices) of the `response.accounts` array, not the actual account objects.\r\n   - As a result, `account.username` is `undefined`, and the comparison `account.username == ssoInTuneAuthUser` always fails.\r\n",
    "state": "closed",
    "created_at": "2024-10-31T10:06:45+00:00",
    "updated_at": "2024-11-28T16:14:53+00:00",
    "closed_at": "2024-11-28T16:14:53+00:00",
    "user": "pazepaze",
    "assignee": null,
    "labels": [],
    "comments_count": 5,
    "html_url": "https://github.com/IsmaelMartinez/teams-for-linux/issues/1466",
    "is_pull_request": false
}