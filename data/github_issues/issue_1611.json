{
    "id": 2949239243,
    "number": 1611,
    "title": "[Bug]: screen sharing not working on ubuntu 22.04",
    "body": "### Can you reproduce this bug in the website/PWA?\n\nYes\n\n### Describe the bug\n\nWe click on share screen and no screen is being displayed. \n\n### What package are you using?\n\nsnap, flatpak, apt-get\n\n### Version\n\nubuntu 22.04\nteams 1.12.7 1.13.0\n\n### Reproduction steps\n\n```markdown\nhello, I have the same issue with :\nOS: ubuntu 22.04 \nTeams: 1.12.7 and 1.13.0 \ninstalled via snap, terminal and flatpak (installation steps will be shared below)\nsame behavior, when we try to share screen, nothing happens but the PC and Teams say that it is being shared. When using snap, it doesn't say we are sharing screen but instead stops accessing the camera \"your video isn't working, we couldn't access your camera\" (and if i press the button to get the camera it works again, but each time i want to share, it get disconnected again) --> behaviour only with snap. \nVia terminal & flatpak everything seems to work, except there is no screen displayed.\n\nIt also doesn't work on firefox, opera and google chrome.\n```\n\n### Expected Behavior\n\n```markdown\nWe click on share screen and see the screen being displayed.\n```\n\n### Debug\n\n```markdown\nRunning the debug:\n\nteams-for-linux --webDebug --appLogLevels=error,info,warn,debug\n\n\nOutputs: \n\nNo config file found, using default values\nall good with appLogLevels you aren't using them\nInitialising logger with config: {\"transports\":{\"console\":{\"level\":\"debug\"},\"file\":{\"level\":false}}}\n12:17:46.353 › Console logging enabled with level debug\n12:17:46.355 › Logger initialised\n12:17:46.355 › configPath: /home/idlab332/.config/teams-for-linux\n12:17:46.355 › configFile: {}\n12:17:46.358 › Running under Wayland, switching to PipeWire...\n12:17:46.672 › processArgs: [\n  '/opt/teams-for-linux/teams-for-linux',\n  '--webDebug',\n  '--appLogLevels=error,info,warn,debug'\n]\n12:17:46.673 › testing RegExp processArgs false\n12:17:46.674 › testing RegExp processArgs false\n12:17:46.674 › testing RegExp processArgs false\n12:17:46.674 › Waiting for network...\n12:17:46.675 › Testing network using net.request() for https://teams.microsoft.com\n12:17:46.677 › Spellchecker is disabled!\n12:17:46.992 › Network test successful with method https\n12:17:46.993 › Loading initial URL...\n[50625:0313/121747.566587:ERROR:CONSOLE(1)] \"Request Autofill.enable failed. {\"code\":-32601,\"message\":\"'Autofill.enable' wasn't found\"}\", source: devtools://devtools/bundled/core/protocol_client/protocol_client.js (1)\n[50625:0313/121747.566924:ERROR:CONSOLE(1)] \"Request Autofill.setAddresses failed. {\"code\":-32601,\"message\":\"'Autofill.setAddresses' wasn't found\"}\", source: devtools://devtools/bundled/core/protocol_client/protocol_client.js (1)\n12:17:47.585 › GetSystemIdleState => IdleTimeout: 300s, IdleTimeoutPollInterval: 10s, ActiveCheckPollInterval: 2s, IdleTime: 0s, IdleState: 'active'\n[50625:0313/121747.590245:ERROR:object_proxy.cc(576)] Failed to call method: org.freedesktop.ScreenSaver.GetActive: object_path= /org/freedesktop/ScreenSaver: org.freedesktop.DBus.Error.NotSupported: This method is not implemented\n12:17:48.896 › did-frame-finish-load {} true\n12:17:48.896 › did-finish-load\n12:17:51.720 › cookie changed cause: overwrite \n removed?: true \n\n12:17:51.722 › cookie: authtoken \n expirationDate: 1741946227.531876 \n domain: teams.microsoft.com\n12:17:51.723 › cookie changed cause: explicit \n removed?: false \n\n12:17:51.723 › cookie: authtoken \n expirationDate: 1741946226.719811 \n domain: teams.microsoft.com\n12:17:52.387 › Badge count set to '0'\n12:17:52.405 › Badge count set to '0'\n12:17:55.817 › did-frame-finish-load {} false\n[50625:0313/121755.824373:ERROR:CONSOLE(1)] \"Request Autofill.enable failed. {\"code\":-32601,\"message\":\"'Autofill.enable' wasn't found\"}\", source: devtools://devtools/bundled/core/protocol_client/protocol_client.js (1)\n[50625:0313/121755.824420:ERROR:CONSOLE(1)] \"Request Autofill.setAddresses failed. {\"code\":-32601,\"message\":\"'Autofill.setAddresses' wasn't found\"}\", source: devtools://devtools/bundled/core/protocol_client/protocol_client.js (1)\n12:17:57.901 › GetSystemIdleState => IdleTimeout: 300s, IdleTimeoutPollInterval: 10s, ActiveCheckPollInterval: 2s, IdleTime: 0s, IdleState: 'active'\n[50754:0313/121802.524221:ERROR:gl_surface_presentation_helper.cc(260)] GetVSyncParametersIfAvailable() failed for 1 times!\n[50625:0313/121802.532450:ERROR:CONSOLE(1)] \"Uncaught (in promise) SyntaxError: Unexpected token 'H', \"HTTP/1.1 4\"... is not valid JSON\", source: devtools://devtools/bundled/devtools_app.html?remoteBase=https://chrome-devtools-frontend.appspot.com/serve_file/@878cb2245944be9dd68beea237f30a58fa63e20/&can_dock=true&toolbarColor=rgba(223,223,223,1)&textColor=rgba(0,0,0,1)&experiments=true (1)\n[50754:0313/121802.537375:ERROR:gl_surface_presentation_helper.cc(260)] GetVSyncParametersIfAvailable() failed for 2 times!\n```\n\n### Additional context\n\nI just passed from ubuntu 20.04  (teams and sharing screen was working one week ago on that ubuntu version) to 22.04 and reinstalled it via snap (tried both 1.12.7 and 1.13.0) via terminal V1.12.7\n```\nsudo wget -qO /etc/apt/keyrings/teams-for-linux.asc https://repo.teamsforlinux.de/teams-for-linux.asc\necho \"deb [signed-by=/etc/apt/keyrings/teams-for-linux.asc arch=$(dpkg --print-architecture)] https://repo.teamsforlinux.de/debian/ stable main\" | sudo tee /etc/apt/sources.list.d/teams-for-linux-packages.list\nsudo apt install teams-for-linux\n```\nand via flatpak:\n```\nsudo apt install flatpak\nsudo apt install gnome-software-plugin-flatpak\nflatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo\nflatpak install flathub com.github.IsmaelMartinez.teams_for_linux\nflatpak run com.github.IsmaelMartinez.teams_for_linux\n```\nflatpak worked on a VM machine of ubuntu 22.04 but doesn't on my native ubuntu 22.04 pc. \nI tested with Teams snap, via firefox, opera and google chrome, same results every time. \n\nmy camera is working just fine, but if I want to share, it gets :\nVia snap: disconnected with the error \"your video isn't working, we couldn't access your camera\" (and if i press the button to get the camera it works again, but each time i want to share, it get disconnected again) \nvia terminal install: \n\n![Image](https://github.com/user-attachments/assets/a013e780-8571-41a2-a0a4-eeb6512ff1a1)\n\nI select built-in-display and share, nothing happens, my camera is still running and i have the widget like I'm sharing my screen but no screen sharing. \nAccording to the snap store, I have all the required permissions. (Via terminal I'm not sure how to check) \n\n![Image](https://github.com/user-attachments/assets/904834bc-c6fd-4970-a44d-73c1f2872ba3)\n(The video is black due to the cache on the webcam). While on a call, the other user will see nothing as well, so it's not just display on my computer. \n\nThe issue is really just Teams, I can share screen via discord (I select monitor and it actually share it). \nIn both cases, I have the icon on the upper right screen of ubuntu actually informing the user the screen is being shared.\n\nSo the command is passed to ubuntu but the image is not displayed in Teams. \n\nThe most unsettling info is that Flatpak works on a VM machine of ubuntu, could be a clue that the issue is deep in the ubuntu 22.04 software. But I do not have the competency myself.\n",
    "state": "closed",
    "created_at": "2025-03-26T11:22:31+00:00",
    "updated_at": "2025-05-06T13:59:03+00:00",
    "closed_at": "2025-05-06T13:59:02+00:00",
    "user": "my-name-is-D",
    "assignee": "IsmaelMartinez",
    "labels": [
        "bug"
    ],
    "comments_count": 12,
    "html_url": "https://github.com/IsmaelMartinez/teams-for-linux/issues/1611",
    "is_pull_request": false
}