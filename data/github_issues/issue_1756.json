{
    "id": 3233688698,
    "number": 1756,
    "title": "[Bug]: Logout every day",
    "body": "### Can you reproduce this bug in the website/PWA?\n\nYes\n\n### Describe the bug\n\nLogout every day\n\n### What package are you using?\n\ndeb\n\n### Version\n\n2.1.0\n\n### Reproduction steps\n\n```markdown\n1.\n2.\n3.\n...\n```\n\n### Expected Behavior\n\n```markdown\n1.\n2.\n3.\n...\n```\n\n### Debug\n\n```markdown\nteams-for-linux --webDebug --logConfig='{}'\n```\n\n### Additional context\n\n# Daily Login Required - Electron/Chromium Cache Overflow Issue\n\n## 🐛 Bug Report\n\n### **Problem Description**\nTeams for Linux requires daily re-authentication while the web version of Teams works persistently without login issues. This appears to be caused by Electron/Chromium cache overflow and token corruption.\n\n### **Steps to Reproduce**\n1. Install teams-for-linux (deb version 2.1.0)\n2. Login to Microsoft Teams\n3. Use the application normally for 1-2 days\n4. Application automatically logs out and requires re-authentication\n5. Pattern repeats daily/every few days\n\n### **Expected Behavior**\n- Teams for Linux should maintain authentication like the web version\n- Users should not need to re-authenticate daily\n- Tokens should persist properly between sessions\n\n### **Actual Behavior**\n- Application forces logout approximately every 24 hours\n- User must re-enter credentials daily\n- Web version (teams.microsoft.com) works without these issues\n\n### **System Information**\n- **OS:** Linux 6.11.0-29-generic\n- **Distribution:** Ubuntu/Debian-based\n- **Teams for Linux Version:** 2.1.0\n- **Installation Method:** deb package\n- **Architecture:** amd64\n\n### **Technical Analysis**\n\n#### **Root Cause Investigation**\nThrough detailed analysis, we discovered:\n\n1. **Cache Size Growth:**\n   ```bash\n   $ du -sh ~/.config/teams-for-linux/\n   622M    ~/.config/teams-for-linux/\n   ```\n\n2. **Electron/Chromium Architecture:**\n   ```\n   teams-for-linux → Electron → Chromium → OAuth tokens\n                                    ↓\n                            Cache overflow (620MB)\n                                    ↓\n                             Token corruption\n                                    ↓\n                           Forced logout\n   ```\n\n3. **Process Analysis:**\n   ```bash\n   $ ps aux | grep teams-for-linux\n   /opt/teams-for-linux/teams-for-linux\n   /opt/teams-for-linux/teams-for-linux --type=zygote\n   /opt/teams-for-linux/teams-for-linux --type=utility\n   ```\n\n#### **Problematic Files/Directories**\n- `~/.config/teams-for-linux/Partitions/teams-4-linux/` (620MB)\n- `DIPS-wal` - OAuth token database\n- `SharedStorage-wal` - Shared storage\n- `Cookies-journal` - Cookie journal\n- Multiple cache directories\n\n#### **Token Lifecycle Issues**\n```\n1. Login → OAuth token received\n2. Store → Chromium saves to local DB\n3. Refresh → Auto-refresh attempts\n4. Corrupt → Cache overflow causes corruption\n5. Logout → Forced re-authentication\n```\n\n### **Comparison with Web Version**\nThe web version doesn't have this issue because:\n- **Isolated sessions** per tab\n- **Browser-managed token handling**\n- **Automatic cache cleanup**\n- **No long-term data accumulation**\n\n### **Workaround Solutions**\n\n#### **1. Cache Cleanup Script**\n```bash\n#!/bin/bash\n# Clear Electron/Chromium cache\npkill -f \"teams-for-linux\"\nrm -rf ~/.config/teams-for-linux/Cache/*\nrm -rf ~/.config/teams-for-linux/Partitions/teams-4-linux/Cache/*\nrm -rf ~/.config/teams-for-linux/Partitions/teams-4-linux/IndexedDB/*\nrm -rf ~/.config/teams-for-linux/Partitions/teams-4-linux/WebStorage/*\n# Remove problematic token files\nrm -f ~/.config/teams-for-linux/DIPS-wal\nrm -f ~/.config/teams-for-linux/SharedStorage-wal\nrm -f ~/.config/teams-for-linux/Cookies-journal\n```\n\n#### **2. Size Monitoring**\n```bash\n# Check cache size\ndu -sh ~/.config/teams-for-linux/\n# Problems typically start when size > 500MB\n```\n\n### **Potential Long-term Solutions**\n\n#### **1. Automatic Cache Management**\n- Implement automatic cache cleanup when size exceeds threshold\n- Add configuration option for cache size limit\n- Regular cleanup of temporary files\n\n#### **2. Token Storage Optimization**\n- Separate token storage from general cache\n- Implement better token refresh logic\n- Add token corruption detection\n\n#### **3. Chromium Flags Optimization**\nConsider adding flags like:\n```bash\n--disable-background-timer-throttling\n--disable-backgrounding-occluded-windows\n--disable-renderer-backgrounding\n```\n\n#### **4. User Configuration Options**\n- Add cache management settings to UI\n- Allow users to configure cache cleanup frequency\n- Provide cache size monitoring\n\n### **Logs and Diagnostics**\n\n#### **Cache Statistics**\n```\nTotal config size: 622MB\nMain cache: ~/.config/teams-for-linux/Cache/\nPartitions cache: ~/.config/teams-for-linux/Partitions/ (620MB)\n```\n\n#### **Problematic File Growth**\n```\nDIPS-wal: 189KB (should be small)\nSharedStorage-wal: exists (should be empty)\nMultiple .org.chromium.Chromium.* temp files\n```\n\n### **Testing Environment**\n- Fresh installation cache: 10-50MB\n- After 1 month usage: 200-400MB\n- Problems start: 500MB+\n- Critical state: 1GB+\n\n### **Frequency Pattern**\n- Daily logout: cache > 800MB\n- Weekly logout: cache 400-600MB\n- Stable operation: cache < 200MB\n\n### **Related Issues**\nThis issue might be related to:\n- Electron cache management\n- Chromium token storage\n- OAuth token refresh mechanisms\n- Long-running application state\n\n### **Additional Context**\n- Issue doesn't occur in web version (teams.microsoft.com)\n- Affects users who keep application running for extended periods\n- Workaround (cache cleanup) is effective but temporary\n- Problem persists across different Linux distributions\n\n### **Proposed Feature Request**\n1. **Built-in cache management** - Automatic cleanup when cache exceeds size limit\n2. **Token persistence improvement** - Better handling of OAuth tokens\n3. **User-configurable cache settings** - Allow users to control cache behavior\n4. **Diagnostic tools** - Built-in cache size monitoring and cleanup options\n\n### **Impact**\n- **User Experience:** Poor - requires daily re-authentication\n- **Productivity:** Reduced - interrupts workflow\n- **Adoption:** May drive users to web version instead\n\n### **Severity**\n**High** - Affects core functionality (authentication persistence)\n\n---\n\n**Thank you for maintaining this project!** This issue affects many users who prefer the desktop application over the web version. The Electron/Chromium cache overflow appears to be the root cause, and implementing automatic cache management would significantly improve user experience./",
    "state": "open",
    "created_at": "2025-07-15T21:00:59+00:00",
    "updated_at": "2025-07-28T16:24:27+00:00",
    "closed_at": null,
    "user": "s-manzhak",
    "assignee": "IsmaelMartinez",
    "labels": [
        "bug"
    ],
    "comments_count": 6,
    "html_url": "https://github.com/IsmaelMartinez/teams-for-linux/issues/1756",
    "is_pull_request": false
}