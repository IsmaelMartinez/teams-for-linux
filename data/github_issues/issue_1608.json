{
    "id": 2948670998,
    "number": 1608,
    "title": "[Bug]: Teams session not started until the window is in the foreground",
    "body": "### Can you reproduce this bug in the website/PWA?\n\nNo\n\n### Describe the bug\n\nThe teams-for-linux app starts properly in a non-primary SwayWM workspace (never focused on startup), but the Teams session only initiates when the window is in the foreground.\n\n### What package are you using?\n\nflatpak\n\n### Version\n\n1.13.1\n\n### Reproduction steps\n\n```markdown\n1. Configure a rule in SwayWM: `for_windw [app_id=\"./teams.for.linux$\"] move container to workspace 5`\n2. Auto start teams with Sway `exec sleep 5; flatpak run com.github.IsmaelMartinez.teams_for_linux --menubar=hidden --disableAutogain --closeAppOnCross`, but the bug is also triggered if manually started.\n3. Observe no notification, no call, etc.\n4. When the workspace is focused, the session starts (splash screen then teams session)\n```\n\n### Expected Behavior\n\n```markdown\nSame as above, except that even in the background, the application should not wait being seen on a monitor, the session should start even in the background.\n```\n\n### Debug\n\n```markdown\nteams-for-linux --webDebug --logConfig='{}'\n\n\n\n$ flatpak run com.github.IsmaelMartinez.teams_for_linux --webDebug --logConfig='{}'\n[2 zypak-helper] Wait found events, but sd-event found none\n[2:0326/083121.253774:ERROR:bus.cc(407)] Failed to connect to the bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory\nNo config file found, using default values\nall good with appLogLevels you aren't using them\nInitialising logger with config: \"{}\"\n08:31:21.419 › File logging at /home/pat/.var/app/com.github.IsmaelMartinez.teams_for_linux/config/teams-for-linux/logs/main.log with level silly\n08:31:21.420 › Console logging enabled with level silly\n08:31:21.421 › Logger initialised\n08:31:21.421 › configPath: /home/pat/.var/app/com.github.IsmaelMartinez.teams_for_linux/config/teams-for-linux\n08:31:21.421 › configFile: {}\n08:31:21.423 › Running under Wayland, switching to PipeWire...\nLaunchProcess: failed to execvp:\nxdg-settings\n[2:0326/083121.475782:ERROR:bus.cc(407)] Failed to connect to the bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory\n[2:0326/083121.475809:ERROR:bus.cc(407)] Failed to connect to the bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory\n08:31:21.517 › processArgs: [\n  '/app/teams-for-linux/teams-for-linux',\n  '--webDebug',\n  '--logConfig={}'\n]\n08:31:21.518 › testing RegExp processArgs false\n08:31:21.519 › testing RegExp processArgs false\n08:31:21.519 › testing RegExp processArgs false\n[2:0326/083121.519448:ERROR:bus.cc(407)] Failed to connect to the bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory\n[2:0326/083121.519479:ERROR:bus.cc(407)] Failed to connect to the bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory\n[2:0326/083121.519499:ERROR:bus.cc(407)] Failed to connect to the bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory\n08:31:21.519 › Waiting for network...\n08:31:21.519 › Testing network using net.request() for https://teams.microsoft.com\n08:31:21.520 › Spellchecker is disabled!\n08:31:21.704 › Network test successful with method https\n08:31:21.705 › Loading initial URL...\n[2:0326/083122.115110:ERROR:CONSOLE(1)] \"Request Autofill.enable failed. {\"code\":-32601,\"message\":\"'Autofill.enable' wasn't found\"}\", source: devtools://devtools/bundled/core/protocol_client/protocol_client.js (1)\n[2:0326/083122.115145:ERROR:CONSOLE(1)] \"Request Autofill.setAddresses failed. {\"code\":-32601,\"message\":\"'Autofill.setAddresses' wasn't found\"}\", source: devtools://devtools/bundled/core/protocol_client/protocol_client.js (1)\n08:31:22.123 › GetSystemIdleState => IdleTimeout: 300s, IdleTimeoutPollInterval: 10s, ActiveCheckPollInterval: 2s, IdleTime: 0s, IdleState: 'active'\n08:31:22.610 › did-frame-finish-load {} true\n08:31:22.610 › did-finish-load\n08:31:22.855 › cookie changed cause: expired-overwrite\n removed?: true\n\n        [--- TRUNCATED... cookie information logs ---]\n\n08:31:23.881 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:23.881 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:23.881 › DENIED setPermissionCheckHandler check geolocation requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:24.394 › Badge count set to '0'\n08:31:24.403 › Badge count set to '0'\n08:31:25.291 › Badge count set to '0'\n\n        [--- TRUNCATED... cookie information logs ---]\n\n08:31:32.188 › GetSystemIdleState => IdleTimeout: 300s, IdleTimeoutPollInterval: 10s, ActiveCheckPollInterval: 2s, IdleTime: 0s, IdleState: 'active'\n08:31:42.191 › GetSystemIdleState => IdleTimeout: 300s, IdleTimeoutPollInterval: 10s, ActiveCheckPollInterval: 2s, IdleTime: 0s, IdleState: 'active'\n\n        [------------------------------]\n        [--- FOCUS ON THE WORKSPACE ---]\n        [------------------------------]\n\n08:31:46.086 › ALLOWED setPermissionCheckHandler check notifications requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:46.276 › ALLOWED setPermissionCheckHandler check notifications requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:46.655 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:46.655 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:46.655 › DENIED setPermissionCheckHandler check geolocation requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n[2:0326/083146.683588:ERROR:CONSOLE(1)] \"Request Autofill.enable failed. {\"code\":-32601,\"message\":\"'Autofill.enable' wasn't found\"}\", source: devtools://devtools/bundled/core/protocol_client/protocol_client.js (1)\n[2:0326/083146.683662:ERROR:CONSOLE(1)] \"Request Autofill.setAddresses failed. {\"code\":-32601,\"message\":\"'Autofill.setAddresses' wasn't found\"}\", source: devtools://devtools/bundled/core/protocol_client/protocol_client.js (1)\n08:31:46.689 › cookie changed cause: overwrite\n removed?: true\n\n        [--- TRUNCATED... cookie information logs ---]\n\n08:31:46.689 › did-frame-finish-load {} false\n08:31:46.689 › cookie changed cause: explicit\n removed?: false\n\n        [--- TRUNCATED... cookie information logs ---]\n\n08:31:47.142 › Badge count set to '1'\n08:31:47.591 › cookie changed cause: overwrite\n removed?: true\n\n        [--- TRUNCATED... cookie information logs ---]\n\n08:31:47.639 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:47.751 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:47.752 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:47.766 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:47.766 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:47.805 › ALLOWED setPermissionCheckHandler check media requested by https://teams.microsoft.com/v2/ with origin https://teams.microsoft.com/\n08:31:48.162 › cookie changed cause: explicit\n removed?: false\n\n        [--- TRUNCATED... cookie information logs ---]\n\n08:31:52.193 › GetSystemIdleState => IdleTimeout: 300s, IdleTimeoutPollInterval: 10s, ActiveCheckPollInterval: 2s, IdleTime: 0s, IdleState: 'active'\n08:31:56.359 › window close\n08:31:56.537 › window closed\n08:31:56.537 › before-quit\n08:31:56.537 › will-quit\n08:31:56.538 › quit\n[2:0326/083156.546313:ERROR:wayland_event_watcher.cc(47)] libwayland: warning: queue 0x35a400ab3a80 destroyed while proxies still attached:\n\n[2:0326/083156.546406:ERROR:wayland_event_watcher.cc(47)] libwayland:   wl_shm_pool#42 still attached\n```\n\n### Additional context\n\nI was previously using the ArchLinux AUR package `teams-for-linux-bin`, with the same behavior.\n\nOverall, it works great, saving my life at work, and this little bug has an existing workaround (focus on the workspace).\n\nBut I can't remember everytime I start my laptop that I have to focus the app to start the session.\n\nMoreover, the system tray icon is shown \"normal\" (white T in blue square, Tux on bottom right, no badge), and does not show that the session has not been initialized.\n\nAt your disposal to provide more debug information.\n\nI'm also ready to hear that this is a limitation from Electron and not Teams itself ;)",
    "state": "closed",
    "created_at": "2025-03-26T07:43:44+00:00",
    "updated_at": "2025-07-04T18:06:23+00:00",
    "closed_at": "2025-05-28T09:37:39+00:00",
    "user": "palb91",
    "assignee": "IsmaelMartinez",
    "labels": [
        "bug",
        "Stale"
    ],
    "comments_count": 10,
    "html_url": "https://github.com/IsmaelMartinez/teams-for-linux/issues/1608",
    "is_pull_request": false
}