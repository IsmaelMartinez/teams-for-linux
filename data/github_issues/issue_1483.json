{
    "id": 2666327164,
    "number": 1483,
    "title": "Error \"Fetched custom background remote configuration but failed to save ... configJSON is not iterable\" in logs",
    "body": "**Describe the bug**\r\n\r\nSee: https://github.com/IsmaelMartinez/teams-for-linux/issues/1424#issuecomment-2480912442\r\n\r\nWhen starting teams-for-linux, I see an error `Fetched custom background remote configuration but failed to save at '/home/myuser/.config/teams-for-linux/custom_bg_remote.json'. configJSON is not iterable` in the logs. Everything works normal and I can select my custom backgrounds, it's just the error log that confuses me.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Have a working custom-background server\r\n2. Configure teams-for-linux to use the custom-background server\r\n3. Start teams-for-linux from a terminal (so you see logs)\r\n4. See error logged\r\n\r\n**Expected behavior**\r\nIf the custom backgrounds are working, I would expect no error to be logged.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Linux / Gentoo\r\n - Installation package: [ebuild](https://github.com/SuperTux88/gentoo-overlay/blob/860fa03bca8592a8e55e96d2bd6d2a7055ff788d/net-im/teams-for-linux/teams-for-linux-1.11.5.ebuild) based on the `deb` package\r\n - Version: 1.11.5 (but I noticed that the error was already logged with an older 1.11.0 version)\r\n\r\n**Debug**\r\n\r\n```bash\r\nteams-for-linux --webDebug --logConfig='{}' --customBGServiceBaseUrl=http://localhost:8080\r\n```\r\n```\r\nall good with appLogLevels you aren't using them\r\nall good with onlineCheckMethod you aren't using them\r\nInitialising logger with config: \"{}\"\r\n19:45:45.164 › File logging at /home/myuser/.config/teams-for-linux/logs/main.log with level silly\r\n19:45:45.166 › Console logging enabled with level silly\r\n19:45:45.166 › Logger initialised\r\n19:45:45.166 › configPath: /home/myuser/.config/teams-for-linux\r\n19:45:45.166 › configFile: {\r\n  optInTeamsV2: true,\r\n  isCustomBackgroundEnabled: true,\r\n  customBGServiceBaseUrl: 'https://my-usual-custom-bg-url.example.com',\r\n  followSystemTheme: true\r\n}\r\n19:45:45.168 › Running under Wayland, switching to PipeWire...\r\n19:45:45.332 › Fetching custom background configuration from 'http://localhost:8080/config.json'\r\n19:45:45.370 › Custom background service url is 'http://localhost:8080'\r\n19:45:45.370 › processArgs: [\r\n  '/opt/teams-for-linux/teams-for-linux',\r\n  '--webDebug',\r\n  '--logConfig={}',\r\n  '--customBGServiceBaseUrl=http://localhost:8080'\r\n]\r\n19:45:45.371 › testing RegExp processArgs false\r\n19:45:45.371 › testing RegExp processArgs false\r\n19:45:45.371 › testing RegExp processArgs false\r\n19:45:45.371 › testing RegExp processArgs false\r\n19:45:45.371 › Waiting for network...\r\n19:45:45.371 › Testing network using net.request() for https://teams.microsoft.com\r\n19:45:45.372 › Spellchecker is disabled!\r\n19:45:45.476 › Fetched custom background remote configuration but failed to save at '/home/myuser/.config/teams-for-linux/custom_bg_remote.json'. configJSON is not iterable\r\n[1428790:1117/194545.615229:ERROR:nss_util.cc(345)] After loading Root Certs, loaded==false: NSS error code: -8018\r\n19:45:45.650 › Network test successful with method https\r\n...\r\n```\r\n\r\n**Additional context**\r\n\r\n> You need a server running to use the custom background (see the docs and the example in the custom background section. Config area). My guess is you are probably not running a server or you haven't got the right config, but I will be able to tell more by looking at the config and your logs.\r\n\r\nSo as written in the comment on the other issue, it's mostly about the error log that appears. I don't know since when this error gets logged, I just noticed it yesterday (I usually don't look at the logs), but I also checked on another computer with an older version and at least on 1.11.0 it also already gets logged.\r\n\r\nI have a working server running, I use it since a long time (even before v2, but I then changed the json to match the v2 format). And it's working, I see my custom backgrounds from my server. But I also see above error message in the logs.\r\n\r\nMy existing server which is configured in my config is nginx based. However when I clone the repo and start `npx http-server -p 8080 --cors \"*\" -g` in this folder: https://github.com/IsmaelMartinez/teams-for-linux/tree/main/app/customBackground/example, and start teams with `--customBGServiceBaseUrl=http://localhost:8080` to override my own server, it also still logs the error, but it now shows me the 3 images from that folder instead of my own images. So it loads the config from the temporary localhost server (I can see it in the access log). If I start teams without that parameter again, it uses the URL from the config file again, and all my own custom backgrounds are back. So it loads the custom backgrounds, but still logs the error every time teams-for-linux gets started.\r\n\r\nHowever, the error isn't about that custom backgrounds can't be loaded, but that it can't store the downloaded backgrounds config locally. But the file still exists and has the content from my usual custom background server (If I start with the localhost background server, it doesn't get changed to that new content). It was last changed on September 3rd (so that's probably since around when the error gets logged, but I just didn't notice it?). If I remove the file, it doesn't get recreated and the error is still logged. But custom-background also still work.\r\n\r\nSo, my questions are:\r\n* Why is this file needed? Custom backgrounds seem to work perfectly even if it can't be written to that file.\r\n* Why is the error logged? It must have worked at some point, but something is broken now (but it doesn't affect the actual usage of custom backgrounds, just storing the local file is broken)",
    "state": "closed",
    "created_at": "2024-11-17T19:17:09+00:00",
    "updated_at": "2024-12-18T11:28:23+00:00",
    "closed_at": "2024-12-09T16:37:01+00:00",
    "user": "SuperTux88",
    "assignee": null,
    "labels": [],
    "comments_count": 11,
    "html_url": "https://github.com/IsmaelMartinez/teams-for-linux/issues/1483",
    "is_pull_request": false
}